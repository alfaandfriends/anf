import{y as c,x as o,u as n,Q as s,F as $,bf as v,t as p,W as i,v as w,z as d,C as O,J as C,K as h,q as V,Y as I,A as R,I as D}from"./@vue-3ecac556.js";import{B as P}from"./Authenticated-da5fe39a.js";import{H as B,L as U}from"./@inertiajs-72b4b122.js";import A from"./StudentInformation-f4e38f93.js";import{h as E}from"./moment-a9aaa855.js";import{a as T}from"./axios-3a665b0f.js";import L from"./FeedbackSummary-d528812a.js";import{e as M}from"./vue-debounce-ed417ae1.js";import{_ as J}from"./Card-aacd8da5.js";import{_ as z,a as W,b as j,c as S,d as H,e as b}from"./TableRow-91ce9765.js";import{_ as F}from"./DialogModal-691e4667.js";import{_ as G}from"./Collapsible-5a7db4b8.js";import{e as K,f as Y,g as q}from"./app-6cbce3f4.js";import{W as Q}from"./lucide-vue-next-214c8f72.js";import"./ApplicationLogo-fd2f7b3a.js";import"./radix-vue-0dbe0706.js";import"./@floating-ui-24f01f9d.js";import"./@internationalized-2f03b566.js";import"./class-variance-authority-ff2c9236.js";import"./clsx-0839fdbe.js";import"./@radix-icons-3edfb593.js";import"./DialogDescription-c92c752a.js";import"./lodash.isequal-1ba6c16d.js";import"./vue-7c584690.js";import"./lodash.clonedeep-8ef52793.js";import"./qs-dba4bf9b.js";import"./side-channel-218a49f6.js";import"./get-intrinsic-88feedc6.js";import"./es-errors-82fd953f.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-1353c55e.js";import"./function-bind-61637ca6.js";import"./hasown-bc561cf0.js";import"./call-bind-9ec8ebd8.js";import"./set-function-length-ecd19468.js";import"./define-data-property-d38573ea.js";import"./es-define-property-cfa03815.js";import"./gopd-4c4454f6.js";import"./has-property-descriptors-68e2873e.js";import"./object-inspect-b36cc063.js";import"./deepmerge-89e33937.js";import"./nprogress-34327965.js";import"./pusher-js-b1694987.js";import"./@vueform-8c23d62f.js";import"./cropperjs-274ed722.js";import"./laravel-vite-plugin-d10ca5e8.js";import"./v-calendar-4075303e.js";import"./tailwind-merge-05141ada.js";import"./@vueuse-25519c21.js";import"./@vuepic-e1682e24.js";import"./@babel-1b80a44a.js";const X={class:"p-1 grid grid-cols-1 gap-4"},Z={class:""},x={class:"mb-3"},ee={class:""},te={class:""},oe={class:"mb-3"},se={key:0,class:"px-4 py-2 bg-slate-100 rounded-lg"},re={class:"flex items-center space-x-2"},ae={class:"p-1"},ie={class:"divide-y"},ne={class:""},le={class:"cursor-pointer"},de={class:""},me={class:"flex justify-between items-center mb-2"},pe={class:"flex items-center"},ue={key:0,class:"text-xs"},_e={class:"flex flex-col gap-2"},fe={class:"relative"},ce={class:""},he={components:{Head:B,Link:U},data(){return{open_prompt:!1,selected_text:"",additional_inputs:"",generating:{comments:!1},improving_comment:!1,show_progress_report:!1,open_objectives:[],searching:!1,progress_report_list:{},list:{teachers:[]},options:{lessons:[],outcomes:[],objectives:[]},loading:{lessons:!1,teachers:!1},search:{lesson_id:"",outcome_id:""},form:{teacher_user_id:"",date:"",report_data:[],comments:"",attendance_status:""}}},methods:{viewProgressReport(a){this.clearSearch(),this.form.report_id=this.$page.props.progress_reports[a].id,this.form.teacher_user_id=this.$page.props.progress_reports[a].teacher_user_id,this.form.teacher_name=this.$page.props.progress_reports[a].display_name,this.form.date=this.$page.props.progress_reports[a].date,this.form.report_data=JSON.parse(this.$page.props.progress_reports[a].report_data)?JSON.parse(this.$page.props.progress_reports[a].report_data):[],this.form.attendance_status=this.$page.props.progress_reports[a].attendance_status,this.form.comments=this.$page.props.progress_reports[a].comments,this.show_progress_report=!0},updateProgressReport(){!this.form.date||this.form.attendance_status==3||this.form.attendance_status==1&&this.form.report_data.length<1||this.form.attendance_status==1&&!this.form.teacher_user_id||this.$inertia.post(route("progress_report.store"),this.form,{preserveScroll:!0,preserveState:!1})},findTeachers:M(function(a){a&&(this.loading.teachers=!0,T.get(route("teachers.find"),{params:{keyword:a}}).then(e=>{this.list.teachers=e.data,this.loading.teachers=!1}))},1e3),getOutcomes(a){this.loading.outcomes=!0,this.options.outcomes=[],this.options.objectives=[],this.search.outcome_id="",this.search.objective_id="",T.get(route("progress_report.get_little_artist_outcomes",a)).then(e=>{this.options.outcomes=e.data,this.loading.outcomes=!1})},addItem(){this.searching||this.search.lesson_id&&this.search.outcome_id&&(this.form.report_data.some(e=>e.outcome_id===this.search.outcome_id)?alert("Item Exists!"):(this.searching=!0,T.get(route("progress_report.get_little_artist_objectives",this.search.outcome_id)).then(e=>{var u;const t={lesson_id:this.search.lesson_id,lesson_name:this.$page.props.little_artist_lessons.find(f=>f.id===this.search.lesson_id).name,outcome_id:this.search.outcome_id,outcome_name:(u=this.options.outcomes.find(f=>f.id===this.search.outcome_id))==null?void 0:u.name,objectives:[]},m=this.form.report_data.length;this.form.report_data.push(t);const l=m,y=this.form.report_data[l];e.data.forEach(f=>{y.objectives.push({id:f.id,name:f.name,achieved:!1})}),this.searching=!1})))},deleteItem(a){this.form.report_data.splice(a,1)},clearSearch(){this.form.teacher_user_id="",this.search.lesson_id="",this.search.outcome_id=""},async generateComment(){if(this.generating.comments)return;this.generating.comments=!0,this.open_prompt=!1,this.form.comments="";const a=await fetch("/api/ai/comment-generator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_prompt:`
                Report Content:
                ${JSON.stringify(this.form.report_data)}

                User Additional Information:
                ${this.additional_inputs}`})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const e=a.body.getReader(),t=new TextDecoder;for(;;){const{done:m,value:l}=await e.read();if(m)break;this.form.comments+=t.decode(l,{stream:!0})}this.additional_inputs="",this.generating.comments=!1},async improveWriting(){if(!this.improving_comment){if(this.improving_comment=!0,this.selected_text){const a=JSON.parse(JSON.stringify(this.selected_text)),e=await fetch("/api/ai/comment-improve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_prompt:`
                Report Content:
                ${JSON.stringify(this.form.report_data)}

                Actual Comment:
                ${this.form.comments}

                Selected phrase:
                ${this.selected_text}`})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=e.body.getReader(),m=new TextDecoder;let l="";for(;;){const{done:y,value:u}=await t.read();if(y)break;l+=m.decode(u,{stream:!0})}this.form.comments=this.form.comments.replaceAll(a,l)}this.improving_comment=!1}},handleSelection(){const a=window.getSelection();a.rangeCount>0&&a.toString().trim().length>0?this.selected_text=a.toString():this.selected_text=""},clearSelection(a){a&&a.relatedTarget&&a.relatedTarget.matches(".improve-btn")||(window.getSelection().removeAllRanges(),this.selected_text="")}}},ct=Object.assign(he,{__name:"LittleArtist",setup(a){return(e,t)=>{const m=v("Button"),l=v("Label"),y=v("Datepicker"),u=v("ComboBox"),f=v("Checkbox"),N=v("Textarea");return p(),c($,null,[o(n(B),{title:"Progress Report"}),o(P,null,{header:s(()=>t[12]||(t[12]=[])),default:s(()=>[o(A),o(J,null,{title:s(()=>t[13]||(t[13]=[i("Progress Reports")])),content:s(()=>[o(n(z),null,{default:s(()=>[o(n(W),{class:"bg-gray-100"},{default:s(()=>[o(n(j),null,{default:s(()=>[o(n(S),null,{default:s(()=>t[14]||(t[14]=[i("#")])),_:1,__:[14]}),o(n(S),null,{default:s(()=>t[15]||(t[15]=[i("Date")])),_:1,__:[15]}),o(n(S),null,{default:s(()=>t[16]||(t[16]=[i("Teacher's Name")])),_:1,__:[16]}),o(n(S),{class:"text-center"},{default:s(()=>t[17]||(t[17]=[i("Status")])),_:1,__:[17]}),o(n(S),{class:"text-center"},{default:s(()=>t[18]||(t[18]=[i("Action")])),_:1,__:[18]})]),_:1})]),_:1}),o(n(H),null,{default:s(()=>[e.$page.props.progress_reports.length?O("",!0):(p(),w(n(j),{key:0},{default:s(()=>[o(n(b),{class:"text-center",colspan:"10"},{default:s(()=>t[19]||(t[19]=[d("div",{class:"p-3"},"No Record Found",-1)])),_:1,__:[19]})]),_:1})),(p(!0),c($,null,C(e.$page.props.progress_reports,(r,_)=>(p(),w(n(j),null,{default:s(()=>[o(n(b),null,{default:s(()=>[i(h(_+1),1)]),_:2},1024),o(n(b),null,{default:s(()=>[i(h(n(E)(r.date).format("DD/MM/Y")),1)]),_:2},1024),o(n(b),null,{default:s(()=>[i(h(r.display_name),1)]),_:2},1024),o(n(b),{class:"text-center"},{default:s(()=>[d("span",{class:V(["inline-flex items-center justify-center px-2 py-1 text-xs rounded",[{"bg-green-200 text-green-600":r.attendance_status==1},{"bg-red-200 text-red-600":r.attendance_status==2},{"bg-gray-200 text-gray-600":r.attendance_status==3},{"bg-blue-200 text-blue-600":r.attendance_status==4}]])},h(r.attendance_status_name),3)]),_:2},1024),o(n(b),{class:"text-center"},{default:s(()=>[o(m,{variant:"outline",onClick:g=>e.viewProgressReport(_)},{default:s(()=>t[20]||(t[20]=[i("Edit")])),_:2,__:[20]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1}),o(L,{report_details:e.$page.props.report_details},null,8,["report_details"]),o(F,{open:e.show_progress_report,"onUpdate:open":t[11]||(t[11]=r=>e.show_progress_report=r)},{title:s(()=>t[21]||(t[21]=[i("Edit Progress Report")])),content:s(()=>[d("div",X,[d("div",Z,[o(l,{id:"date"},{default:s(()=>t[22]||(t[22]=[i("Date"),d("span",{class:"text-red-500"},"*",-1)])),_:1,__:[22]}),o(y,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.date=r),mode:"date",format:"dd/MM/Y",error:!e.form.date,teleport:"#date",teleportCenter:!0},null,8,["modelValue","error"])]),d("div",x,[o(l,null,{default:s(()=>t[23]||(t[23]=[i("Teacher's Name"),d("span",{class:"text-red-500"},"*",-1)])),_:1,__:[23]}),o(u,{items:e.list.teachers,"label-property":"display_name","value-property":"ID",error:e.form.attendance_status==1&&!e.form.teacher_user_id,modelValue:e.form.teacher_user_id,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.teacher_user_id=r),"select-placeholder":e.form.teacher_name,"search-placeholder":"Search teacher...",onSearch:e.findTeachers,loading:e.loading.teachers},null,8,["items","error","modelValue","select-placeholder","onSearch","loading"])]),d("div",ee,[o(l,null,{default:s(()=>t[24]||(t[24]=[i("Lesson")])),_:1,__:[24]}),o(u,{items:e.$page.props.little_artist_lessons,"label-property":"name","value-property":"id",modelValue:e.search.lesson_id,"onUpdate:modelValue":t[2]||(t[2]=r=>e.search.lesson_id=r),"select-placeholder":"Select Lesson","search-placeholder":"Search lesson...",onSelect:t[3]||(t[3]=r=>e.getOutcomes(e.search.lesson_id))},null,8,["items","modelValue"])]),d("div",te,[o(l,null,{default:s(()=>t[25]||(t[25]=[i("Outcome")])),_:1,__:[25]}),o(u,{items:e.options.outcomes,"label-property":"name","value-property":"id",modelValue:e.search.outcome_id,"onUpdate:modelValue":t[4]||(t[4]=r=>e.search.outcome_id=r),"select-placeholder":"Select Outcome","search-placeholder":"Search outcome...",onSelect:e.addItem,loading:e.loading.outcomes},null,8,["items","modelValue","onSelect","loading"])]),d("div",oe,[o(l,null,{default:s(()=>t[26]||(t[26]=[i("Objectives")])),_:1,__:[26]}),e.form.report_data.length?(p(!0),c($,{key:1},C(e.form.report_data,(r,_)=>(p(),w(G,{class:"bg-white",modelValue:e.open_objectives[_],"onUpdate:modelValue":g=>e.open_objectives[_]=g},{trigger:s(()=>[d("div",re,[o(l,null,{default:s(()=>[i(h(r.lesson_name)+" : ",1)]),_:2},1024),o(l,null,{default:s(()=>[i(h(r.outcome_name),1)]),_:2},1024),o(l,{class:"text-red-600 cursor-pointer",onClick:g=>e.deleteItem(_)},{default:s(()=>t[28]||(t[28]=[i("Delete")])),_:2,__:[28]},1032,["onClick"])])]),content:s(()=>[d("div",ae,[d("ul",ie,[(p(!0),c($,null,C(r.objectives,(g,k)=>(p(),c("li",ne,[o(l,{class:"flex items-center space-x-2 py-2"},{default:s(()=>[o(f,{value:g.id,checked:e.form.report_data[_].objectives[k].achieved,onClick:ge=>e.form.report_data[_].objectives[k].achieved=!e.form.report_data[_].objectives[k].achieved},null,8,["value","checked","onClick"]),d("span",le,h(g.name),1)]),_:2},1024)]))),256))])])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),256)):(p(),c("div",se,[o(l,null,{default:s(()=>t[27]||(t[27]=[i("No objectives found.")])),_:1,__:[27]})])),!e.form.report_data.length&&e.form.attendance_status==1?(p(),w(l,{key:2,class:"text-xs text-red-500 font-semibold"},{default:s(()=>t[29]||(t[29]=[i("At least one (1) objective is required.")])),_:1,__:[29]})):O("",!0)]),d("div",de,[d("div",me,[o(l,null,{default:s(()=>t[30]||(t[30]=[i("Comments")])),_:1,__:[30]}),o(n(K),{open:e.open_prompt,"onUpdate:open":t[7]||(t[7]=r=>e.open_prompt=r)},{default:s(()=>[o(n(Y),null,{default:s(()=>[o(m,{size:"xs",variant:"outline",class:"border-0 bg-gradient-to-r from-purple-300 to-indigo-300 hover:bg-gradient-to-r hover:from-indigo-300 hover:to-purple-300"},{default:s(()=>[d("div",pe,[o(n(Q),{class:V(["w-3.5 h-3.5 mr-1 mt-0.5",{"animate-pulse":e.generating.comments}])},null,8,["class"]),e.generating.comments?(p(),c("span",{key:1,class:V(["text-xs",{"animate-pulse":e.generating.comments}])},"Generating...",2)):(p(),c("span",ue,"Generate with AI"))])]),_:1})]),_:1}),o(n(q),{align:"start",side:"left",class:"w-96 bg-gradient-to-r from-purple-200 to-indigo-200 bg-opacity-70 p-2"},{default:s(()=>[d("div",_e,[o(N,{class:"bg-white placeholder:text-sm placeholder:text-zinc-400",rows:"4",type:"text",placeholder:`What would you like to add? 

Example: Teaching methods, activities, issues, in Malay/English and etc...`,modelValue:e.additional_inputs,"onUpdate:modelValue":t[5]||(t[5]=r=>e.additional_inputs=r)},null,8,["modelValue"]),o(m,{size:"xs",class:"",variant:"",onClick:t[6]||(t[6]=r=>e.additional_inputs?e.generateComment():"")},{default:s(()=>t[31]||(t[31]=[i("Prompt It")])),_:1,__:[31]})])]),_:1})]),_:1},8,["open"])]),d("div",fe,[o(N,{class:"mb-2",rows:"10",modelValue:e.form.comments,"onUpdate:modelValue":t[8]||(t[8]=r=>e.form.comments=r),modelModifiers:{lazy:!0},contenteditable:"true",onMouseup:e.handleSelection,onMousedown:e.clearSelection,onBlur:e.clearSelection,onKeyup:e.handleSelection},null,8,["modelValue","onMouseup","onMousedown","onBlur","onKeyup"]),o(I,{name:"fade-slide"},{default:s(()=>[R(o(m,{onBlur:e.clearSelection,onClick:e.improveWriting,size:"xs",variant:"outline",class:"improve-btn bg-gradient-to-r from-purple-200 to-blue-200 font-medium absolute text-xs bottom-3 left-1/2 transform -translate-x-1/2"},{default:s(()=>[i(h(e.improving_comment?"Generating...":"Improve Writing"),1)]),_:1},8,["onBlur","onClick"]),[[D,e.selected_text]])]),_:1})])]),d("div",ce,[o(l,null,{default:s(()=>t[32]||(t[32]=[i("Status")])),_:1,__:[32]}),o(u,{items:e.$page.props.attendance_status,"label-property":"name","value-property":"id",error:e.form.attendance_status==3,modelValue:e.form.attendance_status,"onUpdate:modelValue":t[9]||(t[9]=r=>e.form.attendance_status=r),"select-placeholder":"Select Status","search-placeholder":"Search status..."},null,8,["items","error","modelValue"])])])]),footer:s(()=>[o(m,{variant:"outline",onClick:t[10]||(t[10]=r=>e.show_progress_report=!1)},{default:s(()=>t[33]||(t[33]=[i("Cancel")])),_:1,__:[33]}),o(m,{onClick:e.updateProgressReport},{default:s(()=>t[34]||(t[34]=[i("Save")])),_:1,__:[34]},8,["onClick"])]),_:1},8,["open"])]),_:1})],64)}}});export{ct as default};
