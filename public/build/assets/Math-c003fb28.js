import{y as f,x as s,u as n,Q as o,F as $,bf as c,t as m,W as i,v as w,z as l,C as T,J as j,K as h,q as U,Y as R,A as D,I as M}from"./@vue-3ecac556.js";import{B as O}from"./Authenticated-da5fe39a.js";import{H as N,L as P}from"./@inertiajs-72b4b122.js";import E from"./StudentInformation-f4e38f93.js";import{h as L}from"./moment-a9aaa855.js";import{a as C}from"./axios-3a665b0f.js";import A from"./FeedbackSummary-d528812a.js";import{e as J}from"./vue-debounce-ed417ae1.js";import{_ as z}from"./Card-aacd8da5.js";import{_ as W,a as H,b as B,c as S,d as F,e as v}from"./TableRow-91ce9765.js";import{_ as G}from"./DialogModal-691e4667.js";import{_ as K}from"./Collapsible-5a7db4b8.js";import{_ as I}from"./index-803c4a9c.js";import{e as Y,f as q,g as Q}from"./app-6cbce3f4.js";import{W as X}from"./lucide-vue-next-214c8f72.js";import"./ApplicationLogo-fd2f7b3a.js";import"./radix-vue-0dbe0706.js";import"./@floating-ui-24f01f9d.js";import"./@internationalized-2f03b566.js";import"./class-variance-authority-ff2c9236.js";import"./clsx-0839fdbe.js";import"./@radix-icons-3edfb593.js";import"./DialogDescription-c92c752a.js";import"./lodash.isequal-1ba6c16d.js";import"./vue-7c584690.js";import"./lodash.clonedeep-8ef52793.js";import"./qs-dba4bf9b.js";import"./side-channel-218a49f6.js";import"./get-intrinsic-88feedc6.js";import"./es-errors-82fd953f.js";import"./has-symbols-e8f3ca0e.js";import"./has-proto-1353c55e.js";import"./function-bind-61637ca6.js";import"./hasown-bc561cf0.js";import"./call-bind-9ec8ebd8.js";import"./set-function-length-ecd19468.js";import"./define-data-property-d38573ea.js";import"./es-define-property-cfa03815.js";import"./gopd-4c4454f6.js";import"./has-property-descriptors-68e2873e.js";import"./object-inspect-b36cc063.js";import"./deepmerge-89e33937.js";import"./nprogress-34327965.js";import"./pusher-js-b1694987.js";import"./@vueform-8c23d62f.js";import"./cropperjs-274ed722.js";import"./laravel-vite-plugin-d10ca5e8.js";import"./v-calendar-4075303e.js";import"./tailwind-merge-05141ada.js";import"./@vueuse-25519c21.js";import"./@vuepic-e1682e24.js";import"./@babel-1b80a44a.js";const Z={class:"p-1 grid grid-cols-1 gap-4"},x={class:""},ee={class:""},te={class:"mb-3"},se={class:""},oe={class:""},re={class:""},ae={class:"mb-3"},ie={key:0,class:"px-4 py-2 bg-slate-100 rounded-lg"},ne={class:"flex items-center space-x-2"},le={class:"p-1"},de={class:"flex flex-col space-y-1"},me={key:0,class:"pt-3 divide-y"},pe={class:""},ue={class:"cursor-pointer"},_e={class:""},fe={class:"flex justify-between items-center mb-2"},he={class:"flex items-center"},ge={key:0,class:"text-xs"},ce={class:"flex flex-col gap-2"},ve={class:"relative"},be={class:""},ke={components:{Head:N,Link:P},data(){return{open_prompt:!1,selected_text:"",additional_inputs:"",generating:{comments:!1},improving_comment:!1,value:[],show_progress_report:!1,open_objectives:[],searching:!1,progress_report_list:{},list:{teachers:[]},options:{terms_books:[],units:[],lessons:[],objectives:[]},loading:{terms_books:!1,units:!1,lessons:!1,objectives:!1,teachers:!1},search:{term_book_id:"",unit_id:[],lesson_id:[]},form:{teacher_user_id:"",revision:!0,date:"",report_data:[],comments:"",attendance_status:""}}},methods:{viewProgressReport(a){this.clearSearch(),this.form.report_id=this.$page.props.progress_reports[a].id,this.form.teacher_user_id=this.$page.props.progress_reports[a].teacher_user_id,this.form.teacher_name=this.$page.props.progress_reports[a].display_name,this.form.date=this.$page.props.progress_reports[a].date,this.form.report_data=JSON.parse(this.$page.props.progress_reports[a].report_data)?JSON.parse(this.$page.props.progress_reports[a].report_data):[],this.form.attendance_status=this.$page.props.progress_reports[a].attendance_status,this.form.comments=this.$page.props.progress_reports[a].comments,this.form.revision=!!this.$page.props.progress_reports[a].revision,this.show_progress_report=!0},updateProgressReport(){!this.form.date||this.form.attendance_status==3||this.form.attendance_status==1&&this.form.report_data.length<1||this.form.attendance_status==1&&!this.form.teacher_user_id||this.$inertia.post(route("progress_report.store"),this.form,{preserveScroll:!0,preserveState:!1})},findTeachers:J(function(a){a&&(this.loading.teachers=!0,C.get(route("teachers.find"),{params:{keyword:a}}).then(e=>{this.list.teachers=e.data,this.loading.teachers=!1}))},1e3),getUnits(a){this.loading.units=!0,this.options.units=[],this.options.lessons=[],this.search.unit_id=[],this.search.lesson_id="",C.get(route("progress_report.get_math_units",a)).then(e=>{this.options.units=e.data,this.loading.units=!1})},getLessons(a){this.loading.lessons=!0,this.options.lessons=[],this.search.lesson_id="",C.get(route("progress_report.get_math_lessons",a)).then(e=>{this.options.lessons=e.data,this.loading.lessons=!1})},addItem(){this.searching||this.search.term_book_id&&this.search.unit_id&&this.search.lesson_id&&(this.form.report_data.some(e=>e.lesson_id===this.search.lesson_id)?alert("Item Exists!"):(this.searching=!0,C.get(route("progress_report.get_math_objectives",this.search.lesson_id)).then(e=>{var u,k,y;const t={term_book_id:this.search.term_book_id,term_book_name:(u=this.$page.props.math_terms_books.find(r=>r.id===this.search.term_book_id))==null?void 0:u.name,unit_id:this.search.unit_id,unit_name:(k=this.options.units.find(r=>r.id===this.search.unit_id))==null?void 0:k.name,lesson_id:this.search.lesson_id,lesson_name:(y=this.options.lessons.find(r=>r.id===this.search.lesson_id))==null?void 0:y.name,objectives:[]},p=this.form.report_data.length;this.form.report_data.push(t);const d=p,b=this.form.report_data[d];e.data.forEach(r=>{b.objectives.push({id:r.id,name:r.name,achieved:!1})}),this.searching=!1})))},deleteItem(a){this.form.report_data.splice(a,1)},clearSearch(){this.form.teacher_user_id="",this.search.term_book_id="",this.search.unit_id=[],this.search.lesson_id=""},async generateComment(){if(this.generating.comments)return;this.generating.comments=!0,this.open_prompt=!1,this.form.comments="";const a=await fetch("/api/ai/comment-generator",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_prompt:`
                Report Content:
                ${JSON.stringify(this.form.report_data)}

                User Additional Information:
                ${this.additional_inputs}`})});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const e=a.body.getReader(),t=new TextDecoder;for(;;){const{done:p,value:d}=await e.read();if(p)break;this.form.comments+=t.decode(d,{stream:!0})}this.additional_inputs="",this.generating.comments=!1},async improveWriting(){if(!this.improving_comment){if(this.improving_comment=!0,this.selected_text){const a=JSON.parse(JSON.stringify(this.selected_text)),e=await fetch("/api/ai/comment-improve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_prompt:`
                Report Content:
                ${JSON.stringify(this.form.report_data)}

                Actual Comment:
                ${this.form.comments}

                Selected phrase:
                ${this.selected_text}`})});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=e.body.getReader(),p=new TextDecoder;let d="";for(;;){const{done:b,value:u}=await t.read();if(b)break;d+=p.decode(u,{stream:!0})}this.form.comments=this.form.comments.replaceAll(a,d)}this.improving_comment=!1}},handleSelection(){const a=window.getSelection();a.rangeCount>0&&a.toString().trim().length>0?this.selected_text=a.toString():this.selected_text=""},clearSelection(a){a&&a.relatedTarget&&a.relatedTarget.matches(".improve-btn")||(window.getSelection().removeAllRanges(),this.selected_text="")}}},kt=Object.assign(ke,{__name:"Math",setup(a){return(e,t)=>{const p=c("Button"),d=c("Label"),b=c("Datepicker"),u=c("ComboBox"),k=c("Checkbox"),y=c("Textarea");return m(),f($,null,[s(n(N),{title:"Progress Report"}),s(O,null,{header:o(()=>t[16]||(t[16]=[])),default:o(()=>[s(E),s(z,null,{title:o(()=>t[17]||(t[17]=[i("Progress Reports")])),content:o(()=>[s(n(W),null,{default:o(()=>[s(n(H),{class:"bg-gray-100"},{default:o(()=>[s(n(B),null,{default:o(()=>[s(n(S),null,{default:o(()=>t[18]||(t[18]=[i("#")])),_:1,__:[18]}),s(n(S),null,{default:o(()=>t[19]||(t[19]=[i("Date")])),_:1,__:[19]}),s(n(S),null,{default:o(()=>t[20]||(t[20]=[i("Teacher's Name")])),_:1,__:[20]}),s(n(S),{class:"text-center"},{default:o(()=>t[21]||(t[21]=[i("Status")])),_:1,__:[21]}),s(n(S),{class:"text-center"},{default:o(()=>t[22]||(t[22]=[i("Action")])),_:1,__:[22]})]),_:1})]),_:1}),s(n(F),null,{default:o(()=>[e.$page.props.progress_reports.length?T("",!0):(m(),w(n(B),{key:0},{default:o(()=>[s(n(v),{class:"text-center",colspan:"10"},{default:o(()=>t[23]||(t[23]=[l("div",{class:"p-3"},"No Record Found",-1)])),_:1,__:[23]})]),_:1})),(m(!0),f($,null,j(e.$page.props.progress_reports,(r,_)=>(m(),w(n(B),null,{default:o(()=>[s(n(v),null,{default:o(()=>[i(h(_+1),1)]),_:2},1024),s(n(v),null,{default:o(()=>[i(h(n(L)(r.date).format("DD/MM/Y")),1)]),_:2},1024),s(n(v),null,{default:o(()=>[i(h(r.display_name),1)]),_:2},1024),s(n(v),{class:"text-center"},{default:o(()=>[l("span",{class:U(["inline-flex items-center justify-center px-2 py-1 text-xs rounded",[{"bg-green-200 text-green-600":r.attendance_status==1},{"bg-red-200 text-red-600":r.attendance_status==2},{"bg-gray-200 text-gray-600":r.attendance_status==3},{"bg-blue-200 text-blue-600":r.attendance_status==4}]])},h(r.attendance_status_name),3)]),_:2},1024),s(n(v),{class:"text-center"},{default:o(()=>[s(p,{variant:"outline",onClick:g=>e.viewProgressReport(_)},{default:o(()=>t[24]||(t[24]=[i("Edit")])),_:2,__:[24]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1}),s(A,{report_details:e.$page.props.report_details},null,8,["report_details"]),s(G,{open:e.show_progress_report,"onUpdate:open":t[15]||(t[15]=r=>e.show_progress_report=r)},{title:o(()=>t[25]||(t[25]=[i("Edit Progress Report")])),content:o(()=>[l("div",Z,[l("div",x,[s(d,{id:"date"},{default:o(()=>t[26]||(t[26]=[i("Date"),l("span",{class:"text-red-500"},"*",-1)])),_:1,__:[26]}),s(b,{modelValue:e.form.date,"onUpdate:modelValue":t[0]||(t[0]=r=>e.form.date=r),mode:"date",format:"dd/MM/Y",error:!e.form.date,teleport:"#date",teleportCenter:!0},null,8,["modelValue","error"])]),l("div",ee,[s(d,null,{default:o(()=>t[27]||(t[27]=[i("Teacher's Name"),l("span",{class:"text-red-500"},"*",-1)])),_:1,__:[27]}),s(u,{items:e.list.teachers,"label-property":"display_name","value-property":"ID",error:e.form.attendance_status==1&&!e.form.teacher_user_id,modelValue:e.form.teacher_user_id,"onUpdate:modelValue":t[1]||(t[1]=r=>e.form.teacher_user_id=r),"select-placeholder":e.form.teacher_name,"search-placeholder":"Search teacher...",onSearch:e.findTeachers,loading:e.loading.teachers},null,8,["items","error","modelValue","select-placeholder","onSearch","loading"])]),l("div",te,[s(d,{class:"flex items-center space-x-2"},{default:o(()=>[s(k,{value:e.form.revision,checked:e.form.revision,onClick:t[2]||(t[2]=r=>e.form.revision=!e.form.revision)},null,8,["value","checked"]),t[28]||(t[28]=l("span",{class:"cursor-pointer"},"Revision",-1))]),_:1,__:[28]})]),l("div",se,[s(d,null,{default:o(()=>t[29]||(t[29]=[i("Term / Book")])),_:1,__:[29]}),s(u,{items:e.$page.props.math_terms_books,"label-property":"name","value-property":"id",modelValue:e.search.term_book_id,"onUpdate:modelValue":t[3]||(t[3]=r=>e.search.term_book_id=r),"select-placeholder":"Select Term/Book","search-placeholder":"Search term/book...",onSelect:t[4]||(t[4]=r=>e.getUnits(e.search.term_book_id))},null,8,["items","modelValue"])]),l("div",oe,[s(d,null,{default:o(()=>t[30]||(t[30]=[i("Unit")])),_:1,__:[30]}),s(u,{items:e.options.units,"label-property":"name","value-property":"id",modelValue:e.search.unit_id,"onUpdate:modelValue":t[5]||(t[5]=r=>e.search.unit_id=r),"select-placeholder":"Select Unit","search-placeholder":"Search unit...",onSelect:t[6]||(t[6]=r=>e.getLessons(e.search.unit_id)),loading:e.loading.units},null,8,["items","modelValue","loading"])]),l("div",re,[s(d,null,{default:o(()=>t[31]||(t[31]=[i("Lesson")])),_:1,__:[31]}),s(u,{items:e.options.lessons,"label-property":"name","value-property":"id",modelValue:e.search.lesson_id,"onUpdate:modelValue":t[7]||(t[7]=r=>e.search.lesson_id=r),"select-placeholder":"Select Lesson","search-placeholder":"Search lesson...",onSelect:t[8]||(t[8]=r=>e.addItem()),loading:e.loading.lessons},null,8,["items","modelValue","loading"])]),l("div",ae,[s(d,null,{default:o(()=>t[32]||(t[32]=[i("Objectives")])),_:1,__:[32]}),e.form.report_data.length?(m(!0),f($,{key:1},j(e.form.report_data,(r,_)=>(m(),w(K,{class:"bg-white",modelValue:e.open_objectives[_],"onUpdate:modelValue":g=>e.open_objectives[_]=g},{trigger:o(()=>[l("div",ne,[s(d,null,{default:o(()=>[i(h(r.term_book_name),1)]),_:2},1024),s(d,{class:"text-red-600 cursor-pointer",onClick:g=>e.deleteItem(_)},{default:o(()=>t[34]||(t[34]=[i("Delete")])),_:2,__:[34]},1032,["onClick"])])]),content:o(()=>[l("div",le,[l("div",de,[s(n(I),null,{default:o(()=>[l("span",null,h(r.unit_name),1)]),_:2},1024),s(n(I),{variant:"outline"},{default:o(()=>[l("span",null,h(r.lesson_name),1)]),_:2},1024)]),e.form.revision==!1?(m(),f("ul",me,[(m(!0),f($,null,j(r.objectives,(g,V)=>(m(),f("li",pe,[s(d,{class:"flex items-center space-x-2 py-2"},{default:o(()=>[s(k,{value:g.id,checked:e.form.report_data[_].objectives[V].achieved,onClick:ye=>e.form.report_data[_].objectives[V].achieved=!e.form.report_data[_].objectives[V].achieved},null,8,["value","checked","onClick"]),l("span",ue,h(g.name),1)]),_:2},1024)]))),256))])):T("",!0)])]),_:2},1032,["modelValue","onUpdate:modelValue"]))),256)):(m(),f("div",ie,[s(d,null,{default:o(()=>t[33]||(t[33]=[i("No objectives found.")])),_:1,__:[33]})])),!e.form.report_data.length&&e.form.attendance_status==1?(m(),w(d,{key:2,class:"text-xs text-red-500 font-semibold"},{default:o(()=>t[35]||(t[35]=[i("At least one (1) objective is required.")])),_:1,__:[35]})):T("",!0)]),l("div",_e,[l("div",fe,[s(d,null,{default:o(()=>t[36]||(t[36]=[i("Comments")])),_:1,__:[36]}),s(n(Y),{open:e.open_prompt,"onUpdate:open":t[11]||(t[11]=r=>e.open_prompt=r)},{default:o(()=>[s(n(q),null,{default:o(()=>[s(p,{size:"xs",variant:"outline",class:"border-0 bg-gradient-to-r from-purple-300 to-indigo-300 hover:bg-gradient-to-r hover:from-indigo-300 hover:to-purple-300"},{default:o(()=>[l("div",he,[s(n(X),{class:U(["w-3.5 h-3.5 mr-1 mt-0.5",{"animate-pulse":e.generating.comments}])},null,8,["class"]),e.generating.comments?(m(),f("span",{key:1,class:U(["text-xs",{"animate-pulse":e.generating.comments}])},"Generating...",2)):(m(),f("span",ge,"Generate with AI"))])]),_:1})]),_:1}),s(n(Q),{align:"start",side:"left",class:"w-96 bg-gradient-to-r from-purple-200 to-indigo-200 bg-opacity-70 p-2"},{default:o(()=>[l("div",ce,[s(y,{class:"bg-white placeholder:text-sm placeholder:text-zinc-400",rows:"4",type:"text",placeholder:`What would you like to add? 

Example: Teaching methods, activities, issues, in Malay/English and etc...`,modelValue:e.additional_inputs,"onUpdate:modelValue":t[9]||(t[9]=r=>e.additional_inputs=r)},null,8,["modelValue"]),s(p,{size:"xs",class:"",variant:"",onClick:t[10]||(t[10]=r=>e.additional_inputs?e.generateComment():"")},{default:o(()=>t[37]||(t[37]=[i("Prompt It")])),_:1,__:[37]})])]),_:1})]),_:1},8,["open"])]),l("div",ve,[s(y,{class:"mb-2",rows:"10",modelValue:e.form.comments,"onUpdate:modelValue":t[12]||(t[12]=r=>e.form.comments=r),modelModifiers:{lazy:!0},contenteditable:"true",onMouseup:e.handleSelection,onMousedown:e.clearSelection,onBlur:e.clearSelection,onKeyup:e.handleSelection},null,8,["modelValue","onMouseup","onMousedown","onBlur","onKeyup"]),s(R,{name:"fade-slide"},{default:o(()=>[D(s(p,{onBlur:e.clearSelection,onClick:e.improveWriting,size:"xs",variant:"outline",class:"improve-btn bg-gradient-to-r from-purple-200 to-blue-200 font-medium absolute text-xs bottom-3 left-1/2 transform -translate-x-1/2"},{default:o(()=>[i(h(e.improving_comment?"Generating...":"Improve Writing"),1)]),_:1},8,["onBlur","onClick"]),[[M,e.selected_text]])]),_:1})])]),l("div",be,[s(d,null,{default:o(()=>t[38]||(t[38]=[i("Status")])),_:1,__:[38]}),s(u,{items:e.$page.props.attendance_status,"label-property":"name","value-property":"id",error:e.form.attendance_status==3,modelValue:e.form.attendance_status,"onUpdate:modelValue":t[13]||(t[13]=r=>e.form.attendance_status=r),"select-placeholder":"Select Status","search-placeholder":"Search status..."},null,8,["items","error","modelValue"])])])]),footer:o(()=>[s(p,{variant:"outline",onClick:t[14]||(t[14]=r=>e.show_progress_report=!1)},{default:o(()=>t[39]||(t[39]=[i("Cancel")])),_:1,__:[39]}),s(p,{onClick:e.updateProgressReport},{default:o(()=>t[40]||(t[40]=[i("Save")])),_:1,__:[40]},8,["onClick"])]),_:1},8,["open"])]),_:1})],64)}}});export{kt as default};
